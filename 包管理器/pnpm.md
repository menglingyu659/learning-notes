## pnpm

### pnpm是一个新起的包管理器*（简单来说它现在还是一个npm的包）*，从npm的下载量来看，目前还没有超过yarn，但它的实现方式值得主流包管理器学习，某些开发者极力推荐pnpm



### 从结果来看，它具有以下优势：

1. #### 目前，安装效率高于npm和yarn的最新版

2. #### 极其简洁的node_modules目录

3. #### 避免了开发时使用间接依赖的问题，就是说我们不能直接使用`require("简介依赖")`命令，引入间接依赖（*安装一个依赖，这个依赖有安装了“其他依赖”，这个"其他依赖"叫做间接依赖*）

4. #### 能极大的降低磁盘空间的占用



### 安装和使用

#### 安装

```powershell
npm install -g pnpm #安装pnpm是会提供一个CLI命令，后面的包管理都是用这个命令，所以最好使用全局安装，不然每一个工程要使用pnpm的命令的话，都需要安装一次
```

#### 使用

##### 将npm换成pnpm就可以

##### 如果要执行安装在局部的CLI时，可以使用pnpx，它和npx功能完全一样，唯一不同的是，在使用pnpx执行一个需要安装的命令时，会使用pnpm进行安装

> ##### 运行`npx mocha`命令当这个mocha CLI工具在局部没有安装时，npx会让npm临时安装这个包并运行，用pnpx就会让pnpm安装这个包，==类似于`yarn create`命令==



### 原理

1. ##### 同 npm 和 yarn 一样，pnpm 同样使用缓存来保存已安装过的包，以及使用pnpm-lock.yaml来记录确切的依赖版本

2. ##### 它下载过的包的缓存地址放在使用`pnpm install`命令时所在盘的根目录下

3. ##### 不同于 yarn 和 npm，pnpm 使用==符号链接和硬链接==（可将他们想象成快捷方式）的做法来放置依赖，从而规避了从缓存中拷贝文件的时间，使得安装和卸载的速度更快。

   > ##### yarn和npm缓存依赖的做法：yarn和npm是将依赖文件缓存起来，如果再次使用该包，会将其拷贝到工程中
   >
   > ##### pnpm缓存依赖的做法：

4. ##### 由于使用的==符号链接和硬链接==，pnpm 可以规避windows操作系统路径过长的问题，因此它选择使用树形的依赖结构，有着几乎完美的依赖管理。也因此，项目中只能使用直接依赖，而不能使用间接依赖。



### 注意事项

##### 由于 pnpm 会改动 node_modules 目录结构，使得每个包只能使用直接依赖，而不能使用间接依赖，因此，如果使用 pnpm 安装的包中存在使用间接依赖的引用方式时，会出现问题（现在即使使用依赖包中存在间接依赖的引入也不会出现问题除非使用路径引入`require("./node_modules/a/xxx")`

##### 由于 pnpm 超高的安装和卸载效率，越来越多的包开始修正之前使用间接依赖的代码





###### pnpm详细实现原理还没听

